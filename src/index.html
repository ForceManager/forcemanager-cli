<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>ForceManager Dev</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Roboto:400' rel='stylesheet' type='text/css'>
</head>
<body>
    <div class="header">
        <h1 class="title">ForceManager {{widgetType}} Widget Dev</h1>
        <div class="config-icon" onClick="toggleConfig()">
            <img src="https://fmassets.s3.amazonaws.com/sfmCustomWidgets/pro/1.0.0m/trafficLight/img/cog_icon.png">
        </div>
    </div>
    <div class="config-panel" id="config-panel">
        <div class="config-panel-item">
            <label>{{entity}} ID</label>
            <input type="text" id="companyId" name="companyId">
        </div>
        <div class="config-panel-item">
            <label>URL Base</label>
            <input type="text" id="urlBase" name="urlBase" placeholder="https://api.forcemanager.net/api/v4">
        </div>
        <div class="config-panel-item">
            <label>Token</label>
            <textarea id="token" name="token"></textarea>
        </div>
        <div class="config-panel-item">
            <button type="button" id="save" name="save" onClick="onSave()">Save</button>
        </div>
    </div>
    <div class="widget widget-col-{{columns}}">
        <div class="widget-header">
            <div class="widget-title" class="title">{{title}}</div>
        </div>
        <div class="widget-content" id="widget-content"></div>
    </div>
    <script type="text/javascript" src="http://localhost:5500/lib/fm-bridge-backend.js"></script>
    <script type="text/javascript">
        window.onload = function () {
            let context = {
                type: 'widget',
                widgetType: '{{widgetType}}',
                entity: '{{entity}}',
            };
            context['loginToken'] = sessionStorage.getItem('fmDevToken') ? sessionStorage.getItem('fmDevToken') : '';
            context['companyId'] = sessionStorage.getItem('fmDevCompanyId') ? sessionStorage.getItem('fmDevCompanyId') : '';
            context['urlBase'] = sessionStorage.getItem('fmDevUrlBase') ? sessionStorage.getItem('fmDevUrlBase') : 'https://api.forcemanager.net/api/v4';
            document.getElementById('token').value = context.loginToken;
            document.getElementById('companyId').value = context.companyId;
            document.getElementById('urlBase').value = context.urlBase;
            if (context.loginToken && context.companyId && context.urlBase) {
                window.FmBridgeBackend.init(context);
                window.FmBridgeBackend.setContext(context);
                window.FmBridgeBackend.loadFragment({{id}}, 'http://localhost:{{port}}', 'widget-content');
            } else {
                console.log('No Context set')
                var panel = document.getElementById('config-panel');
                panel.classList.toggle("show");
            }
        };
        function onSave() {
            sessionStorage.setItem('fmDevToken', document.getElementById('token').value);
            sessionStorage.setItem('fmDevCompanyId', document.getElementById('companyId').value);
            sessionStorage.setItem('fmDevUrlBase', document.getElementById('urlBase').value);
            location.reload();
        }
        function toggleConfig () {
            var panel = document.getElementById('config-panel');
            panel.classList.toggle("show");
        }
    </script>
</body>
<style>
    body{
        position: relative;
        display: flex;
        flex-wrap: wrap;
        margin: 0;
        font-family: Roboto;
        width: 100vw;
        overflow-x: hidden;
    }
    .header {
        width: 100%;
        background-color: #f8f8f8;
        border-bottom: 1px solid #eaeaea;
        padding: 15px 0;
        margin: 0;
        z-index: 100;
    }
    .title{
        width: 100%;
        margin: 0;
        padding: 0;
        text-align: center;
        text-transform: capitalize;
    }
    .config-icon{
        position: absolute;
        top: 25px;
        right: 20px;
        cursor: pointer;
    }
    .config-panel{
        position: absolute;
        top: 69px;
        right: -340px;
        width: 330px;
        min-height: calc(100vh - 69px);
        box-sizing: border-box;
        background-color: #f8f8f8;
        padding: 30px;
        border-left: 1px solid #eaeaea;
        box-shadow: #9e9e9e99 -3px 0px 15px 0px;
        transition: .3s;
    }
    .config-panel.show{
        right: 0;
    }
    .config-panel-item{
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 20px;
    }
    .config-panel-item label{
        display: flex;
        margin-bottom: 5px;
    }
    input {
        width: 100%;
        font-size: 14px;
        padding: 5px;
        box-sizing: border-box;
    }
    textarea {
        width: 100%;
        height: 170px;
        border-color: #cccccc;
        font-size: 14px;
        padding: 5px;
        box-sizing: border-box;
    }
    button{
        background-color: #FF8800;
        color: #FFF;
        display: inline-block;
        padding: 11px 25px;
        margin-bottom: 0;
        font-size: 12px;
        font-weight: 400;
        line-height: 1.42857143;
        text-align: center;
        white-space: nowrap;
        vertical-align: middle;
        cursor: pointer;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        background-image: none;
        border: 1px solid transparent;
        border-radius: 4px;
        text-transform: uppercase;
        font-weight: 400;
        letter-spacing: 1px;
    }
    .widget {
        float: left;
        height: 300px;
        background-color: white;
        margin: 20px;
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.15);
    }
    .widget-col-1{
        width: 33%;
    }
    .widget-col-2{
        width: 50%;
    }
    .widget-col-3{
        width: 100%;
    }
    .widget-header{
        position: relative;
        height: 40px;
        background-color: #f8f8f8;
        font-size: 13px;
        letter-spacing: 0.5px;
        padding: 10px 20px;
        border-bottom: 1px solid #eaeaea;
        box-sizing: border-box;
    }
    .widget-title{
        font-family: Roboto;
        color: #212121;
        font-weight: 400;
        text-transform: none;
    }
    .widget-content {
        height: 260px;
        overflow-y: auto;
        background-color: white;
    }
    .forceframe{
        width: 100%;
        height: 100%;
        border: none;
    }
</style>
</html>
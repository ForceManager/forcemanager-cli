<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>ForceManager Dev</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Roboto:400' rel='stylesheet' type='text/css'>
</head>
<body id="dev-body">
    <div class="header">
        <h1 class="title">ForceManager Fragment Development - {{widgetType}} {{type}}</h1>
        <div class="config-icon" onClick="toggleConfig()">
            <img src="https://fmassets.s3.amazonaws.com/sfmCustomWidgets/pro/1.0.0m/trafficLight/img/cog_icon.png">
        </div>
    </div>
    <div class="config-panel" id="config-panel">
        <div class="config-panel-item">
            <label>{{entity}} ID</label>
            <input type="text" id="companyId" name="companyId">
        </div>
        <div class="config-panel-item">
            <label>User ID</label>
            <input type="text" id="userId" name="userId">
        </div>
        <div class="config-panel-item">
            <label>URL Base</label>
            <input type="text" id="urlBase" name="urlBase" placeholder="https://api.forcemanager.net/api/v4">
        </div>
        <div class="config-panel-item">
            <label>Token</label>
            <textarea id="token" name="token"></textarea>
        </div>
        <div class="config-panel-item">
            <button type="button" id="save" name="save" onClick="onSave()">Save</button>
        </div>
    </div>
    <div id="widget" class="widget widget-col-{{columns}}">
        <div class="widget-header">
            <div class="widget-title">{{title}}</div>
        </div>
        <div class="widget-content" id="widget-content"></div>
    </div>
    <div id="form" class="form">
        <div class="form-header">
            <div id="form-title" class="form-title">Creación formulario</div>
        </div>
        <div id="form-camera-images" class="form-camera-images">
            <div class="form-camera-images-header">
                <div class="form-camera-images-header-title">IMÁGENES</div>
                <div class="form-camera-images-header-collapse" onClick="toggleImages()"><</div>
            </div>
            <div class="form-camera">
                <div class="form-camera-icon"></div>
            </div>
            <div class="form-images"></div>
        </div>
        <div class="form-content" id="form-content"></div>
    </div>
    <div id="page" class="page"></div>
    <div id="loader" class="loader">
        <div class="loader-icon"></div>
    </div>
    <div id="confirm-dialog" class="confirm-dialog">
        <div class="confirm-dialog-box">
            <div id="confirm-dialog-msg" class="confirm-dialog-msg"></div>
            <div class="confirm-dialog-buttons">
                <div id="confirm-dialog-button-ko" class="confirm-dialog-button"  onClick="confirmDialog('KO')"></div>
                <div id="confirm-dialog-button-ok" class="confirm-dialog-button"  onClick="confirmDialog('OK')"></div>
            </div>
        </div>
    </div>
    <div id="alert-dialog" class="alert-dialog">
        <div class="alert-dialog-box">
            <div id="alert-dialog-msg" class="alert-dialog-msg"></div>
            <div class="alert-dialog-buttons">
                <div id="alert-dialog-button" class="alert-dialog-button"  onClick="alertDialog()"></div>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="http://localhost:5500/lib/fm-bridge-backend.js"></script>
    <script type="text/javascript">
        window.onload = function () {
            let context = {
                type: '{{type}}',
                widgetType: '{{widgetType}}',
                entity: '{{entity}}',
                deviceOS: 'web',
            };
            let domEl;
            context['dev'] = true;
            context['loginToken'] = sessionStorage.getItem('fmDevToken') ? sessionStorage.getItem('fmDevToken') : '';
            context['companyId'] = sessionStorage.getItem('fmDevCompanyId') ? sessionStorage.getItem('fmDevCompanyId') : '';
            context['urlBase'] = sessionStorage.getItem('fmDevUrlBase') ? sessionStorage.getItem('fmDevUrlBase') : 'https://api.forcemanager.net/api/v4';
            let userId = sessionStorage.getItem('userId') ? sessionStorage.getItem('userId') : '';
            let userName = localStorage.getItem('name') ? localStorage.getItem('name') : '';
            context['user'] = { 'id': userId, 'name': userName };
            document.getElementById('token').value = context.loginToken;
            document.getElementById('companyId').value = context.companyId;
            document.getElementById('userId').value = context.userId;
            document.getElementById('urlBase').value = context.urlBase;
            switch (context.type) {
                case 'widget':
                    domEl = 'widget-content';
                    break;
                case 'form':
                    document.getElementById('form').style.display = 'block';
                    document.getElementById('widget').outerHTML = '';
                    document.getElementById('page').outerHTML = '';
                    domEl = 'form-content';
                    context['form'] = {
                        'entityForm': null,
                        'mode': 'creation',
                        'isReadonly': false,
                        'idState': -1,
                        'endState': 0,
                    };
                    break;
                case 'page':
                    domEl = 'page';
                    break;
            }
            if (context.loginToken && context.companyId && context.urlBase) {
                window.FmBridgeBackend.init(context);
                // window.FmBridgeBackend.setContext(context);
                window.FmBridgeBackend.loadFragment({{id}}, 'http://localhost:{{port}}', domEl);
            } else {
                console.log('No Context set')
                let panel = document.getElementById('config-panel');
                panel.classList.toggle("show");
            }
        };
        function onSave() {
            sessionStorage.setItem('fmDevCompanyId', document.getElementById('companyId').value);
            sessionStorage.setItem('userId', document.getElementById('userId').value);
            sessionStorage.setItem('fmDevToken', document.getElementById('token').value);
            sessionStorage.setItem('fmDevUrlBase', document.getElementById('urlBase').value);
            location.reload();
        };

        function toggleConfig() {
            let panel = document.getElementById('config-panel');
            panel.classList.toggle('show');
        };

        var dialogId = '';

        window.fmDevFunctions = {
            setTitle(title) {
                document.getElementById('form-title').innerHTML = title;
            },

            collapseImagesView() {
                document.getElementById('form-camera-images').classList.add('collapse');
            },

            expandImagesView() {
                document.getElementById('form-camera-images').classList.remove('collapse');
            },

            showCameraImages() {
                document.getElementById('form-camera-images').classList.add('show');
            },

            hideCameraImages() {
                document.getElementById('form-camera-images').classList.remove('show');
            },

            showLoading() {
                document.getElementById('loader').classList.add('show');
            },

            hideLoading() {
                document.getElementById('loader').classList.remove('show');
            },

            showConfirmDialog(id, message, btnOkStr, btnKOStr) {
                document.getElementById('confirm-dialog-msg').innerHTML = message;
                document.getElementById('confirm-dialog-button-ko').innerHTML = btnKOStr;
                document.getElementById('confirm-dialog-button-ok').innerHTML = btnOkStr;
                document.getElementById('confirm-dialog').classList.add('show');
                dialogId = id;
            },

            hideConfirmDialog() {
                document.getElementById('confirm-dialog').classList.remove('show');
            },

            showAlertDialog(id, message, btnOk) {
                document.getElementById('alert-dialog-msg').innerHTML = message;
                document.getElementById('alert-dialog-button').innerHTML = btnOk;
                document.getElementById('alert-dialog').classList.add('show');
                dialogId = id;
            },

            hideAlertDialog() {
                document.getElementById('alert-dialog').classList.remove('show');
            },
        };
        
        function confirmDialog(res) {
            var event = new CustomEvent('showConfirmDialogResponse', {
                detail: { callbackId: dialogId, response: res }
            });
            window.dispatchEvent(event);
        };
    </script>
</body>
<style>
    body{
        position: relative;
        display: flex;
        flex-wrap: wrap;
        margin: 0;
        font-family: Roboto;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
    }
    .header {
        width: 100%;
        height: 40px;
        background-color: #f8f8f8;
        border-bottom: 1px solid #eaeaea;
        padding: 10px 0;
        margin: 0;
        box-sizing: border-box;
        z-index: 100;
    }
    .title{
        width: 100%;
        margin: 0;
        padding: 0;
        text-align: center;
        text-transform: capitalize;
        font-size: 20px;
        line-height: 20px;
    }
    .config-icon{
        position: absolute;
        top: 10px;
        right: 20px;
        cursor: pointer;
    }
    .config-panel{
        position: absolute;
        top: 40px;
        right: -340px;
        width: 330px;
        min-height: calc(100vh - 40px);
        box-sizing: border-box;
        background-color: #f8f8f8;
        padding: 30px;
        border-left: 1px solid #eaeaea;
        box-shadow: #9e9e9e99 -3px 0px 15px 0px;
        transition: .3s;
    }
    .config-panel.show{
        right: 0;
    }
    .config-panel-item{
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 20px;
    }
    .config-panel-item label{
        display: flex;
        margin-bottom: 5px;
    }
    input {
        width: 100%;
        font-size: 14px;
        padding: 5px;
        box-sizing: border-box;
    }
    textarea {
        width: 100%;
        height: 170px;
        border-color: #cccccc;
        font-size: 14px;
        padding: 5px;
        box-sizing: border-box;
    }
    button{
        background-color: #FF8800;
        color: #FFF;
        display: inline-block;
        padding: 11px 25px;
        margin-bottom: 0;
        font-size: 12px;
        font-weight: 400;
        line-height: 1.42857143;
        text-align: center;
        white-space: nowrap;
        vertical-align: middle;
        cursor: pointer;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        background-image: none;
        border: 1px solid transparent;
        border-radius: 4px;
        text-transform: uppercase;
        font-weight: 400;
        letter-spacing: 1px;
    }
    .widget {
        float: left;
        height: 300px;
        background-color: white;
        margin: 20px;
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.15);
        display: none;
    }
    .widget-col-1{
        width: 33%;
    }
    .widget-col-2{
        width: 50%;
    }
    .widget-col-3{
        width: 100%;
    }
    .widget-header{
        position: relative;
        height: 40px;
        background-color: #f8f8f8;
        font-size: 13px;
        letter-spacing: 0.5px;
        padding: 10px 20px;
        border-bottom: 1px solid #eaeaea;
        box-sizing: border-box;
    }
    .widget-title{
        font-family: Roboto;
        color: #212121;
        font-weight: 400;
        font-size: 20px;
        text-transform: none;
    }
    .widget-content {
        height: 260px;
        overflow-y: auto;
        background-color: white;
    }
    .form {
        width: 100%;
        height: calc(100vh - 40px);
        overflow: scroll;
        display: none;
    }
    .form-header {
        height: 40px;
        background-color: #565656;
        font-size: 13px;
        letter-spacing: 0.5px;
        padding: 10px 20px;
        box-sizing: border-box;
    }
    .form-title {
        font-family: Roboto;
        color: #fff;
        font-weight: 400;
        font-size: 16px;
        text-transform: none;
    }
    .form-camera-images {
        height: 80px;
        background-color: #f8f8f8;
        display: none;
    }
    .form-camera-images.show {
        display: flex;
    }
    .form-camera-images.collapse {
        height: 40px;
    }
    .form-camera-images-header {
        padding: 10px 20px;
        display: flex;
        justify-content: space-between;
    }
    .form-camera-images-header-title {
        color: #555;
    }
    .form-camera-images-header-collapse {
        cursor: pointer;
    }
    .form-camera {

    }
    .form-camera-icon {

    }
    .form-images {

    }
    .form-content {
        height: 100%;
    }
    .fragment{
        width: 100%;
        height: 100%;
        border: none;
    }
    .loader {
        position: absolute;
        height: 100%;
        width: 100%;
        background-color: #21212170;
        justify-content: center;
        align-items: center;
        display: none;
    }
    .loader.show {
        display: flex;
    }
    .loader-icon{
        height: 60px;
        width: 60px;
        background-color: #fff;
    }
    .confirm-dialog {
        position: absolute;
        height: 100%;
        width: 100%;
        background-color: #21212170;
        justify-content: center;
        align-items: center;
        display: none;
    }
    .confirm-dialog.show {
        display: flex;
    }
    .confirm-dialog-box {
        width: 500px;
        padding: 30px 20px;
        background-color: #fff;
        box-shadow: 3px 3px 2px #656565b5;
    }
    .confirm-dialog-msg {
        margin-bottom: 30px;
        text-align: center;
    }
    .confirm-dialog-buttons {
        display: flex;
        justify-content: center;
    }
    .confirm-dialog-button {
        width: 100px;
        padding: 10px 0;
        background-color: #D67D03;
        margin: 0 10px;
        color: white;
        line-height: 20px;
        transform: uppercase;
        border-radius: 20px;
        text-align: center;
        cursor: pointer;
    }
    
    .alert-dialog {
        position: absolute;
        height: 100%;
        width: 100%;
        background-color: #21212170;
        justify-content: center;
        align-items: center;
        display: none;
    }
    .alert-dialog.show {
        display: flex;
    }
    .alert-dialog-box {
        width: 500px;
        padding: 30px 20px;
        background-color: #fff;
        box-shadow: 3px 3px 2px #656565b5;
    }
    .alert-dialog-msg {
        margin-bottom: 30px;
        text-align: center;
    }
    .alert-dialog-buttons {
        display: flex;
        justify-content: center;
    }
    .alert-dialog-button {
        width: 100px;
        padding: 10px 0;
        background-color: #D67D03;
        margin: 0 10px;
        color: white;
        line-height: 20px;
        transform: uppercase;
        border-radius: 20px;
        text-align: center;
        cursor: pointer;
    }
</style>
</html>